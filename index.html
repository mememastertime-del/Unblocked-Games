<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Astral Employment</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#07070a;
  --panel:#0f1113;
  --muted:#bfc7d0;
  --accent:#0a9dff;
  --card:#161717;
  --glass: rgba(255,255,255,0.03);
}

/* Reset */
*{box-sizing:border-box;margin:0;padding:0}

/* Body */
body{
  font-family:Inter, sans-serif;
  background:linear-gradient(180deg,#030307,#0b0c0f);
  color:#eaf2ff;
  overflow:hidden;
}

/*************************************
  LOGIN SCREEN
*************************************/
#homeScreen{
  height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:.9rem;
  text-align:center;
}
#homeScreen h1{
  font-size:2.4rem;font-weight:800;color:#fff;
}
#passwordInput{
  width:300px;padding:.75rem;border-radius:10px;
  border:none;background:#151515;font-size:1rem;color:#fff;
}
#enterBtn{
  width:220px;padding:.7rem;border-radius:10px;
  background:var(--accent);color:#fff;font-weight:700;
  border:none;cursor:pointer;
}
#errorMsg{color:#ff6a6a;height:1.1rem;font-size:.9rem}

#announcementBar{
  max-width:360px;padding:.7rem;border-radius:10px;
  background:rgba(255,255,255,0.02);
  border:1px solid rgba(255,255,255,0.05);
  font-size:.95rem;color:var(--muted);
}

/*************************************
 LANDING HERO
*************************************/
#landingScreen{display:none;height:100vh;align-items:center;justify-content:center;padding:1.4rem;}
.hero{max-width:1200px;width:100%;display:flex;gap:2rem;align-items:center;justify-content:center;}
.feature-list{margin-top:.7rem;display:flex;flex-direction:column;gap:.4rem}
.btn{border:none;border-radius:10px;padding:.7rem 1rem;cursor:pointer;font-weight:700}
.btn-primary{background:var(--accent);color:#fff}
.btn-ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.05)}

/*************************************
 SIDE NAVIGATION PANEL
*************************************/
#sideNav{
  position:fixed;top:0;left:0;height:100vh;
  width:68px;background:#0c0d0e;
  display:flex;flex-direction:column;align-items:center;
  padding:.7rem .4rem;z-index:50;
  transition:width .24s ease;
}
#sideNav.open{width:220px;}
.nav-item{
  width:100%;
  display:flex;align-items:center;
  gap:.8rem;color:var(--muted);
  padding:.7rem;border-radius:10px;cursor:pointer;
  white-space:nowrap;font-size:.95rem;
  margin-top:.4rem;
}
.nav-item:hover{background:rgba(255,255,255,0.04);color:#fff}
.nav-label{opacity:0;transition:opacity .25s;}
#sideNav.open .nav-label{opacity:1}

/*************************************
  MAIN CONTENT WRAPPER
*************************************/
#mainContent{
  position:absolute;top:0;left:68px;
  width:calc(100% - 68px);height:100vh;
  padding:1rem 1.2rem;overflow-y:auto;
  transition:left .25s,width .25s;
}
#sideNav.open + #mainContent{
  left:220px;width:calc(100% - 220px);
}

/*************************************
  SEARCH + CATEGORY BAR
*************************************/
#searchBox{
  width:260px;padding:.6rem .9rem;border-radius:10px;
  border:none;background:#151515;color:#fff;
}
#categoryBar{
  margin-top:.9rem;display:flex;gap:.5rem;
  overflow-x:auto;padding-bottom:.4rem;
  -webkit-overflow-scrolling:touch;
}
.cat-btn{
  display:flex;align-items:center;gap:.4rem;
  padding:.45rem .7rem;border-radius:999px;
  background:rgba(255,255,255,0.02);color:var(--muted);
  border:1px solid transparent;cursor:pointer;
}
.cat-btn.active{background:rgba(10,157,255,0.16);color:#fff;border-color:rgba(10,157,255,0.3)}

/*************************************
  GAME GRID + FEATURED + RECENT
*************************************/
.featured-row, .recent-row{
  display:flex;gap:1rem;align-items:center;margin-bottom:1.2rem;
}

.featured-card{
  flex:1;border-radius:12px;
  background:var(--glass);
  padding:1rem;display:flex;gap:1rem;
}

.game-list{
  display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));
  gap:1rem;padding-bottom:3rem;
}
.game-card{
  background:var(--card);border-radius:12px;
  height:250px;overflow:hidden;
  box-shadow:0 4px 18px rgba(0,0,0,0.8);
  position:relative;cursor:pointer;
  transition:transform .18s, box-shadow .18s;
}
.game-card:hover{
  transform:translateY(-5px);
  box-shadow:0 12px 40px rgba(0,0,0,0.9);
}
.thumbnail{
  width:100%;height:120px;object-fit:cover;
}
.card-body{padding:.7rem;display:flex;flex-direction:column;gap:.5rem;flex:1}
.title{font-weight:700;font-size:1rem;color:#fff;height:2.3em;overflow:hidden}
.tags{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:auto}
.tag{font-size:.7rem;background:rgba(255,255,255,0.05);padding:.2rem .45rem;border-radius:7px}

.hover-details{
  position:absolute;inset:0;
  background:linear-gradient(180deg,transparent,#000c);
  opacity:0;display:flex;flex-direction:column;
  justify-content:flex-end;gap:.5rem;
  padding:.7rem;transition:opacity .2s;
}
.game-card:hover .hover-details{opacity:1}

.no-results{text-align:center;color:var(--muted);padding:2rem}

/*************************************
 CHAT
*************************************/
#chatMessages{
  height:60vh;overflow-y:auto;background:#0e0e10;
  padding:.7rem 1rem;border-radius:8px;
  margin:1rem 0;
}

/*************************************
 ADMIN MODAL
*************************************/
.modal-backdrop{
  position:fixed;inset:0;
  background:rgba(0,0,0,0.6);
  display:flex;align-items:center;justify-content:center;
  z-index:300;
}
.modal{
  background:#0f1113;padding:1rem;border-radius:10px;
  width:360px;max-width:90%;
}
.input{width:100%;padding:.6rem .8rem;border-radius:8px;border:none;background:#151515;color:#fff;margin-bottom:.7rem;}
</style>
</head>
<body>

<!-- üîí LOGIN SCREEN -->
<div id="homeScreen">
  <h1>Astral Employment</h1>
  <div id="announcementBar">Loading announcement...</div>
  <input id="passwordInput" type="password" placeholder="Access Code">
  <button id="enterBtn">Enter</button>
  <div id="errorMsg"></div>
</div>

<!-- üéØ LANDING -->
<div id="landingScreen">
  <div class="hero">
    <div>
      <h1>Welcome to Astral Employment</h1>
      <div class="feature-list">
        <span>Hover details</span>
        <span>Featured Games</span>
        <span>Emoji Categories</span>
        <span>Smooth animations</span>
      </div>

      <button id="enterHubBtn" class="btn btn-primary" style="margin-top:.9rem">Enter Hub</button>
    </div>
  </div>
</div>

<!-- üìå SIDE NAV PANEL -->
<div id="sideNav">
  <div style="cursor:pointer" id="navToggle">
    <!-- SVG LOGO -->
    <svg width="42" height="42" viewBox="0 0 64 64">
      <circle cx="32" cy="32" r="18" fill="url(#g1)"></circle>
      <defs>
      <radialGradient id="g1" cx="30%" cy="30%">
        <stop offset="0%" stop-color="#9be3ff"/>
        <stop offset="60%" stop-color="#6b68ff"/>
        <stop offset="100%" stop-color="#2a1b5f" stop-opacity="0"/>
      </radialGradient>
      </defs>
      <path d="M32 10 L34 26 L54 28 L34 30 L32 50 L30 30 L10 28 L30 26 Z" fill="#fff">
        <animateTransform attributeName="transform" type="rotate" from="0" to="360" dur="11s" repeatCount="indefinite"/>
      </path>
    </svg>
  </div>
  <div id="navGames" class="nav-item">üéÆ <span class="nav-label">Games</span></div>
  <div id="navChat" class="nav-item">üí¨ <span class="nav-label">Chat</span></div>
  <div id="navOther" class="nav-item">üåê <span class="nav-label">Websites</span></div>
  <div id="navAdmin" class="nav-item">üîê <span class="nav-label">Admin</span></div>
</div>

<!-- üìç CONTENT -->
<div id="mainContent" style="display:none">
  <input id="searchBox" type="search" placeholder="Search games...">
  <div id="categoryBar"></div>
  <div id="app"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/***************************************************
  ‚öôÔ∏è CONFIG + STATE
***************************************************/
const HASH_MAIN = "875b0cbe469a54473cd975c129b87fadaa6d15d6dacf0634ea24b70e0b58c04b"; // DIHALB
const HASH_ADMIN = "23c28e809cef8751da4a6393e9cb183b8d969f77ab0ade39e6b282e19e40378f"; // th!nBlu3

const GAMES_JSON_URL = "https://raw.githubusercontent.com/swarmintelli/Unblocked-Games-CDN/main/games.json";

const firebaseConfig = {
  apiKey: "AIzaSyAyHooV5floB-DdLAFdczfgEuDPEWtfGgA",
  authDomain: "chatroom-4e6e4.firebaseapp.com",
  databaseURL: "https://chatroom-4e6e4-default-rtdb.firebaseio.com",
  projectId: "chatroom-4e6e4",
  storageBucket: "chatroom-4e6e4.firebasestorage.app",
  messagingSenderId: "352956674536",
  appId: "1:352956674536:web:1942c8198827e8f5f6b45d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const ANN_PATH = "announcement/latest";

let admin = sessionStorage.getItem("astral_admin") === "1";
let gamesCache = [];
let category = "all";
const categories = ["all","action","adventure","puzzle","racing","multiplayer","strategy","sports","classics"];

/***************************************************
  üîê UTILS
***************************************************/
async function sha(s){
  const d = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(s));
  return Array.from(new Uint8Array(d)).map(b=>b.toString(16).padStart(2,"0")).join("");
}
function escapeHtml(s){return s.replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]))}

/***************************************************
  üîí MAIN LOGIN
***************************************************/
enterBtn.onclick = async ()=>{
  const h = await sha(passwordInput.value.trim());
  if(h===HASH_MAIN){
    passwordInput.value="";
    homeScreen.style.display="none";
    landingScreen.style.display="flex";
  }
  else{
    errorMsg.textContent="Incorrect";
    passwordInput.value="";
  }
};

/***************************************************
  üß≠ NAVIGATION
***************************************************/
function toggleNav(){
  sideNav.classList.toggle("open");
}
navToggle.onclick = toggleNav;

navGames.onclick = ()=>{toggleNav();showGameList();};
navChat.onclick = ()=>{toggleNav();showChat();};
navOther.onclick = ()=>{toggleNav();showOther();};
navAdmin.onclick = ()=>{toggleNav();openAdminLogin();};

/***************************************************
  üéÆ ENTER HUB
***************************************************/
enterHubBtn.onclick = async ()=>{
  landingScreen.style.display="none";
  mainContent.style.display="block";
  await loadGames();
  showGameList();
};

/***************************************************
  üì° LOAD GAMES SAFELY
***************************************************/
async function loadGames(){
  try{
    const data = await fetch(GAMES_JSON_URL).then(r=>r.json());
    gamesCache = data;
  }catch{}
}

/***************************************************
  üéÆ GAME LIST RENDER
***************************************************/
function showGameList(){
  if(!gamesCache.length) return setTimeout(showGameList,200);

  categoryBar.innerHTML="";
  categories.forEach(c=>{
    const b = document.createElement("button");
    b.className="cat-btn"+(c===category?" active":"");
    b.textContent=c==="all"?"‚ú® All":c;
    b.onclick=()=>{category=c;showGameList();};
    categoryBar.appendChild(b);
  });

  const q=(searchBox.value||"").trim().toLowerCase();
  const filtered = gamesCache.filter(g=>{
    const tags=(g.tags||[]).map(t=>t.toLowerCase());
    const name=(g.name||"").toLowerCase();
    return (!q||name.includes(q)||tags.some(t=>t.includes(q))) &&
           (category==="all"||tags.includes(category));
  });

  app.innerHTML="";
  if(!filtered.length) return app.innerHTML=`<div class="no-results">No results</div>`;

  const grid=document.createElement("div");
  grid.className="game-list";
  filtered.forEach(g=>{
    const card=document.createElement("div");
    card.className="game-card";

    card.innerHTML=`
      <img class="thumbnail" src="${g.game_image_icon||""}">
      <div class="card-body">
        <div class="title">${escapeHtml(g.name)}</div>
        <div class="tags">${(g.tags||[]).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("")}</div>
      </div>
      <div class="hover-details">
        <button class="btn btn-primary">Play</button>
      </div>
    `;

    card.onclick=()=>showGamePage(g);
    card.querySelector("button").onclick=e=>{e.stopPropagation();showGamePage(g);};
    grid.appendChild(card);
  });
  app.appendChild(grid);
}

/***************************************************
  üïπ GAME PAGE
***************************************************/
function showGamePage(g){
  app.innerHTML=`<div class="back-link" style="cursor:pointer;margin-bottom:.5rem;color:var(--muted)">‚Üê Back</div>`;
  document.querySelector(".back-link").onclick=showGameList;

  const f=document.createElement("iframe");
  f.style="width:100%;height:75vh;border:none;border-radius:10px;background:#000";
  f.src=g.game_url||g.url||"";
  app.appendChild(f);
}

/***************************************************
  üí¨ CHAT
***************************************************/
function showChat(){
  app.innerHTML=`
    <div class="back-link" style="cursor:pointer;margin-bottom:.5rem;color:var(--muted)">‚Üê Back</div>
    <div id="chatMessages"></div>
    <input id="chatInput" class="input" placeholder="Message">
    <button id="chatSend" class="btn btn-primary" style="margin-top:.5rem">Send</button>
  `;
  document.querySelector(".back-link").onclick=showGameList;
  const msgs=document.getElementById("chatMessages");
  db.ref("chat").off();
  db.ref("chat").on("child_added", snap=>{
    const d=document.createElement("div");
    d.textContent=snap.val();
    d.style.padding=".4rem;margin:.3rem 0;background:#111;border-radius:6px;";
    msgs.appendChild(d);
    msgs.scrollTop=msgs.scrollHeight;
  });
  chatSend.onclick=()=>{
    if(!chatInput.value.trim())return;
    db.ref("chat").push(chatInput.value.trim());
    chatInput.value="";
  };
}

/***************************************************
  üåê OTHER WEBSITES
***************************************************/
function showOther(){
  app.innerHTML=`
    <div class="back-link" style="cursor:pointer;margin-bottom:.5rem;color:var(--muted)">‚Üê Back</div>
    <div><a href="https://example.com" target="_blank">Example</a></div>
  `;
  document.querySelector(".back-link").onclick=showGameList;
}

/***************************************************
  üîê ADMIN
***************************************************/
function openAdminLogin(){
  if(admin) return openAdminPanel();
  const b=document.createElement("div");
  b.className="modal-backdrop";
  b.innerHTML=`
    <div class="modal">
      <h3 style="margin-bottom:.5rem">Admin Login</h3>
      <input id="adPw" class="input" type="password" placeholder="Password">
      <button id="adGo" class="btn btn-primary" style="width:100%">Login</button>
    </div>`;
  document.body.appendChild(b);
  adGo.onclick=async ()=>{
    if(await sha(adPw.value.trim())===HASH_ADMIN){
      admin=true;sessionStorage.setItem("astral_admin","1");
      b.remove();openAdminPanel();
    }
    else adPw.value="";
  };
}
function openAdminPanel(){
  app.innerHTML=`
    <div>
      <h2>Admin Panel</h2>
      <textarea id="adAnn" class="input" style="height:120px;margin-top:.6rem"></textarea>
      <button id="adSave" class="btn btn-primary" style="margin-top:.6rem">Save</button>
    </div>`;
  db.ref(ANN_PATH).once("value").then(s=>{
    const v=s.val(); adAnn.value=v?v.text:"";
  });
  adSave.onclick=()=>{
    db.ref(ANN_PATH).set({text:adAnn.value,updatedAt:Date.now()});
  };
}

/***************************************************
  üì£ ANNOUNCEMENTS LISTEN
***************************************************/
db.ref(ANN_PATH).on("value", snap=>{
  const v=snap.val();
  announcementBar.innerHTML = v ? escapeHtml(v.text) : "No announcements.";
});
</script>

</body>
</html>
