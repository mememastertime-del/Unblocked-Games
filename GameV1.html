<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Game Hub</title>

<style>
  body { margin:0; font-family: "Inter", Arial, sans-serif; background:#0e0e0e; color:#eee; }
  /* Home screen */
  #homeScreen { height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; background: linear-gradient(135deg,#1a1a1a,#000); text-align:center; }
  #homeScreen h1 { font-size:3rem; font-weight:700; margin-bottom:1rem; }
  #passwordInput { padding:.7rem 1rem; border-radius:8px; border:none; outline:none; width:250px; background:#222; color:#fff; font-size:1rem; margin-bottom:1rem; }
  #enterBtn { padding:.7rem 1rem; width:200px; border:none; border-radius:8px; background:#008cff; color:#fff; font-size:1.2rem; cursor:pointer; transition:.15s; }
  #enterBtn:hover { background:#0a9dff; }
  #errorMsg { margin-top:.5rem; color:#ff5f5f; }

  /* Header */
  header { display:none; background:#1a1a1a; padding:1rem 2rem; position:sticky; top:0; z-index:10; box-shadow:0 2px 10px rgba(0,0,0,.5); display:flex; justify-content:space-between; align-items:center; gap:1rem; }
  #searchBox { padding:.6rem 1rem; width:250px; background:#242424; border:none; outline:none; border-radius:6px; color:#fff; font-size:1rem; }
  #categorySelect { background:#242424; border:none; outline:none; padding:.6rem; border-radius:6px; color:#fff; font-size:1rem; }
  #navLinks { display:flex; gap:1rem; }
  #navLinks a { color:#9cf; text-decoration:none; font-size:1rem; transition:.15s; }
  #navLinks a:hover { color:#0a9dff; }

  /* Game list */
  .game-list { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:1rem; padding:1rem; }
  .game-card { background:#1c1c1c; border-radius:8px; overflow:hidden; cursor:pointer; transition:.15s ease-in-out; }
  .game-card:hover { transform:scale(1.04); background:#242424; }
  .game-card img { width:100%; height:120px; object-fit:cover; }
  .title { text-align:center; padding:.6rem; font-size:.95rem; height:2.8em; overflow:hidden; }

  .container { padding:1rem; }
  .back-link { display:inline-block; margin-bottom:1rem; color:#9cf; font-size:1.1rem; cursor:pointer; }

  iframe { width:100%; height:80vh; border:none; border-radius:8px; background:#000; }

  /* Chatroom */
  #chatContainer { display:flex; flex-direction:column; height:80vh; gap:.5rem; }
  #chatMessages { flex:1; overflow-y:auto; background:#1c1c1c; padding:.5rem; border-radius:6px; }
  #chatInputContainer { display:flex; gap:.5rem; }
  #chatInput { flex:1; padding:.5rem; border-radius:6px; border:none; background:#242424; color:#fff; }
  #chatSend { padding:.5rem 1rem; border:none; border-radius:6px; background:#008cff; color:#fff; cursor:pointer; }
</style>
</head>
<body>

<!-- HOME SCREEN -->
<div id="homeScreen">
  <h1>Welcome to Game Hub</h1>
  <input id="passwordInput" type="password" placeholder="Enter password...">
  <button id="enterBtn">Enter</button>
  <div id="errorMsg"></div>
</div>

<!-- MAIN APP -->
<header id="mainHeader">
  <div id="navLinks">
    <a href="#" onclick="showGameList(gamesCache)">Games</a>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSeCfC4vHF_dR_iV-9n9Af6X3SrYsWwFG3CjAsbuoHBwOH3nUg/viewform?usp=dialog" target="_blank">Requests</a>
    <a href="#" onclick="showChat()">Chatroom</a>
    <a href="#" onclick="showOtherWebsites()">Other Websites</a>
  </div>
  <select id="categorySelect"><option value="all">All Categories</option></select>
  <input id="searchBox" type="text" placeholder="Search games...">
</header>

<div id="app"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const PASSWORD = "DIHALB";
  const GAMES_JSON_URL = "https://raw.githubusercontent.com/swarmintelli/Unblocked-Games-CDN/main/games.json";

  const firebaseConfig = {
    apiKey: "AIzaSyAyHooV5floB-DdLAFdczfgEuDPEWtfGgA",
    authDomain: "chatroom-4e6e4.firebaseapp.com",
    databaseURL: "https://chatroom-4e6e4-default-rtdb.firebaseio.com",
    projectId: "chatroom-4e6e4",
    storageBucket: "chatroom-4e6e4.firebasestorage.app",
    messagingSenderId: "352956674536",
    appId: "1:352956674536:web:1942c8198827e8f5f6b45d"
  };

  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  let gamesCache = [];
  let categories = [];

  // ===== PASSWORD =====
  document.getElementById("enterBtn").addEventListener("click", () => {
    const pw = document.getElementById("passwordInput").value;
    if (pw === PASSWORD) {
      document.getElementById("homeScreen").style.display = "none";
      document.getElementById("mainHeader").style.display = "flex";
      loadGames().then(() => showGameList(gamesCache));
    } else {
      document.getElementById("errorMsg").textContent = "Incorrect password.";
    }
  });

  // ===== LOAD GAMES =====
  async function loadGames() {
    const resp = await fetch(GAMES_JSON_URL);
    const data = await resp.json();
    gamesCache = data;

    // Extract categories
    categories = ["all"];
    data.forEach(g => {
      if (Array.isArray(g.tags)) {
        g.tags.forEach(t => { if(!categories.includes(t)) categories.push(t); });
      }
    });

    const sel = document.getElementById("categorySelect");
    categories.forEach(cat => {
      const op = document.createElement("option");
      op.value = cat;
      op.textContent = cat.charAt(0).toUpperCase()+cat.slice(1);
      sel.append(op);
    });
    return data;
  }

  // ===== GAME LIST =====
  function showGameList(games) {
    const app = document.getElementById("app");
    app.innerHTML = "";
    const list = document.createElement("div"); list.className="game-list";

    games.forEach(game => {
      const card = document.createElement("div"); card.className="game-card";
      card.onclick = ()=>showGamePage(game);

      const img = document.createElement("img"); img.loading="lazy"; img.src=game.game_image_icon;
      const title = document.createElement("div"); title.className="title"; title.textContent=game.name;

      card.append(img,title); list.append(card);
    });
    app.append(list);
  }

  // ===== GAME PAGE =====
  function showGamePage(game){
    const app = document.getElementById("app"); app.innerHTML="";
    const container = document.createElement("div"); container.className="container";

    const back = document.createElement("span"); back.className="back-link"; back.textContent="← Back to games"; back.onclick=()=>showGameList(gamesCache);

    const iframe = document.createElement("iframe"); iframe.srcdoc=game.iframe;

    container.append(back,iframe); app.append(container);
  }

  // ===== FILTER =====
  function filterGames() {
    const q = document.getElementById("searchBox").value.toLowerCase();
    const cat = document.getElementById("categorySelect").value;
    const filtered = gamesCache.filter(g=>{
      const nameMatch=g.name.toLowerCase().includes(q);
      const catMatch=(cat==="all" || (g.tags && g.tags.includes(cat)));
      return nameMatch && catMatch;
    });
    showGameList(filtered);
  }
  document.getElementById("searchBox").addEventListener("input",filterGames);
  document.getElementById("categorySelect").addEventListener("change",filterGames);

  // ===== CHATROOM =====
  function showChat(){
    const app=document.getElementById("app"); app.innerHTML="";
    const container=document.createElement("div"); container.className="container";
    const back=document.createElement("span"); back.className="back-link"; back.textContent="← Back to games"; back.onclick=()=>showGameList(gamesCache);
    const chatDiv=document.createElement("div"); chatDiv.id="chatContainer";

    const messages=document.createElement("div"); messages.id="chatMessages";
    const inputContainer=document.createElement("div"); inputContainer.id="chatInputContainer";
    const input=document.createElement("input"); input.id="chatInput"; input.placeholder="Type a message...";
    const send=document.createElement("button"); send.id="chatSend"; send.textContent="Send";

    inputContainer.append(input,send);
    chatDiv.append(messages,inputContainer);
    container.append(back,chatDiv);
    app.append(container);

    // Listen for messages
    database.ref("chat").on("child_added", snap=>{
      const msg=snap.val();
      const div=document.createElement("div"); div.textContent=msg; messages.append(div);
      messages.scrollTop=messages.scrollHeight;
    });

    // Send message
    send.onclick=()=>{
      const val=input.value.trim();
      if(val==="") return;
      database.ref("chat").push(val);
      input.value="";
    }
  }

  // ===== OTHER WEBSITES =====
  function showOtherWebsites(){
    const app=document.getElementById("app"); app.innerHTML="";
    const container=document.createElement("div"); container.className="container";
    const back=document.createElement("span"); back.className="back-link"; back.textContent="← Back to games"; back.onclick=()=>showGameList(gamesCache);

    const list=document.createElement("div"); list.id="otherWebsitesList";
    const input=document.createElement("input"); input.placeholder="Paste URL here"; input.style.width="70%";
    const btn=document.createElement("button"); btn.textContent="Add"; btn.style.marginLeft="0.5rem";

    container.append(back,input,btn,list); app.append(container);

    const stored=JSON.parse(localStorage.getItem("otherWebsites")||"[]");
    stored.forEach(u=>addLink(u));

    btn.onclick=()=>{
      const val=input.value.trim(); if(!val) return;
      let arr=JSON.parse(localStorage.getItem("otherWebsites")||"[]"); arr.push(val); localStorage.setItem("otherWebsites",JSON.stringify(arr));
      addLink(val); input.value="";
    };

    function addLink(url){
      const a=document.createElement("a"); a.href=url; a.target="_blank"; a.textContent=url; a.style.display="block"; a.style.marginTop="0.3rem"; list.append(a);
    }
  }

</script>
</body>
</html>
